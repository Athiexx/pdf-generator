<!DOCTYPE html>
<html lang="en">

<!-- I have to work on displaying the button-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/styles.css">
    <script src="./jquery/jquery-3.7.1.min.js"></script>
    <script type="module" src="./index.js"></script>
    <script>
        const $ = window.jQuery;
        var ticket = "";

        function authenticate() {
            const existingTicket = sessionStorage.getItem("alfrescoTicket");
            if (existingTicket) {
                console.log("Using existing authentication ticket:", existingTicket);
                return existingTicket; // already have a ticket
            }
            const authData = {
                "userId": "admin",
                "password": "rep0master"
            }

            $.ajax({
                url: "https://ecm-dev.dsnyad.nycnet/alfresco/api/-default-/public/authentication/versions/1/tickets",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(authData),
                success: function (response) {
                    ticket = response.entry.id;
                    console.log("Authentication ticket:", ticket);
                    // store it as a session so we can authenticate next time
                    sessionStorage.setItem("alfrescoTicket", ticket);
                    console.log("New ticket stored retrieved and stored in sessionStorage.");
                },
                // xhr contains the actual response from the server
                error: function (xhr, status, error) {
                    console.error("Error status:", status);
                    console.error("Error code:", xhr.status);
                    console.error("Authentication failed:", error);
                    console.error("Response:", xhr.responseText);
                    console.error("Server Headers:", xhr.getAllResponseHeaders());
                }
            });
            return ticket;
        }
    </script>
    <title>Capital Budget Test Page</title>
</head>

<body onload="authenticate()">
    <div id="dsnyLogo-container" class="dsnyLogo">
        <img src="./images/New_York_City_Department_of_Sanitation_logo.svg" class="dsnyLogo"
            alt="New York City Department of Sanitation Logo">
    </div>

    <div id="header-container">
        <h1><u>Welcome to the Capital Budget Test Page!</u></h1>
    </div>
    <div id="content-container">
        <p>This is a simple HTML page for testing purposes. This page is to meant to take in information from the user
            and then generate a PDF from the filled out fields. <b>NOTE: You are required to fill out fields or else you
                cannot submit the form.</b></p>
        <p>This page allows you to have the ability to fill out two different forms:</p>
        <ul>
            <li>Capital Budget CP Documents</li>
            <li>Employee Information</li>
        </ul>
        <p>In order to choose which form to fill out, select one of the checkboxes below.</p>
        <p>After you check one of the boxes, you will be prompted to fill out the information from the form you
            selected.</p>
    </div>
    <div id="select-form-container" class="flex-column-container">
        <h2>Please select a form</h2>
        <div>
            <input type="radio" id="cpDocument-form" name="formchoice" value="CP Document">
            <label for="cpDocument-form">Capital Budget CP Document Form </label>
        </div>
        <div>
            <input type="radio" id="employeeInfo-form" name="formchoice" value="Employee Information">
            <label for="employeeInfo-form">Employee Information</label>
        </div>
        <div>
            <input type="radio" id="pdfTemplate-form" name="formchoice" value="PDF Template">
            <label for="pdfTemplate-form">PDF Template Form</label>
        </div>
    </div>

    <div id="form-display-container" class="flex-column-container">
        <h2 id="form-header"></h2>
        <div id="form-content-area"></div>
    </div>
    <div id="submit-button-display-container" class="is-hidden">
        <div id="submit-button-content-area" class="flex-column-container">
        </div>
    </div>
    <div id="form-output-container">
        <iframe id="pdf-iframe" class="is-hidden"></iframe>
    </div>
    <div id="error-form-output-container"></div>
</body>

</html>