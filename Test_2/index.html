<!DOCTYPE html>
<html lang="en">

<!-- I have to work on displaying the button-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="shortcut icon" type="image/png" href="./images/icons8-favicon-50.png">
    <script src="./jquery/jquery-3.7.1.min.js">
    </script>
    <script>
        window.ticket = "";

        window.authenticate = function () {
            return new Promise((resolve, reject) => {
                const uploadUrl = "https://ecm-dev.dsnyad.nycnet/alfresco/api/-default-/public/authentication/versions/1/tickets";
                const existingTicket = sessionStorage.getItem("alfrescoTicket");

                if (existingTicket) {
                    window.ticket = existingTicket;
                    console.log("Ticket:", window.ticket);
                    console.log("Using existing ticket from session.");
                    return resolve(existingTicket);
                }
                // user id and password to be authenticated 
                const authData = {
                    "userId": "admin",
                    "password": "rep0master"
                };

                // using jquery to authenticate + upload the thing to alfresco
                $.ajax({
                    url: uploadUrl,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(authData),
                    success: function (response) {
                        // Accessing the specific Alfresco V1 response path
                        window.ticket = response.entry.id;
                        sessionStorage.setItem("alfrescoTicket", window.ticket);
                        console.log("Ticket:", window.ticket);
                        resolve(window.ticket);
                    },
                    error: function (xhr, status, error) {
                        console.error("Error status from server:", xhr.status);
                        console.error("Status text:", xhr.statusText)
                        console.error("Auth failed:", xhr.responseText);
                        console.error("XHR Object:", xhr);
                        reject(xhr);
                    }
                });
            });
        };
    </script>
    <script type="module" src="./index.js"></script>
    <title>Capital Budget Test Page</title>
</head>

<body onload="authenticate()">
    <div id="dsnyLogo-container" class="dsnyLogo">
        <img src="./images/New_York_City_Department_of_Sanitation_logo.svg" class="dsnyLogo"
            alt="New York City Department of Sanitation Logo">
    </div>

    <div id="header-container">
        <h1><u>Welcome to the Capital Budget Test Page!</u></h1>
    </div>
    <div id="content-container">
        <p>This is a simple HTML page for testing purposes. This page is to meant to take in information from the user
            and then generate a PDF from the filled out fields.</p>
        <p>This page allows you to have the ability to fill out three different forms:</p>
        <ul>
            <li>Capital Budget CP Documents</li>
            <li>Employee Information</li>
            <li>PDF Template Form</li>
        </ul>
        <p>In order to choose which form to fill out, select one of the checkboxes below.</p>
        <p>After you check one of the boxes, you will be prompted to fill out the information from the form you
            selected.</p>
    </div>
    <div id="select-form-container" class="flex-column-container">
        <h2>Please select a form</h2>
        <div>
            <input type="radio" id="cpDocument-form" name="formchoice" value="CP Document">
            <label for="cpDocument-form">Capital Budget CP Document Form </label>
        </div>
        <div>
            <input type="radio" id="employeeInfo-form" name="formchoice" value="Employee Information">
            <label for="employeeInfo-form">Employee Information</label>
        </div>
        <div>
            <input type="radio" id="pdfTemplate-form" name="formchoice" value="PDF Template">
            <label for="pdfTemplate-form">PDF Template Form</label>
        </div>
    </div>
    <div id="ticket-error-container"></div>
    <div id="form-display-container" class="flex-column-container">
        <h2 id="form-header"></h2>
        <div id="form-content-area"></div>
    </div>
    <div id="submit-button-display-container" class="is-hidden">
        <div id="submit-button-content-area" class="flex-column-container">
        </div>
    </div>
    <div id="form-output-container">
        <iframe id="pdf-iframe" class="is-hidden"></iframe>
    </div>
    <div id="error-form-output-container"></div>
</body>

</html>